<%- include('./partials/header') %>

<!-- Main Shop Section -->
<div class="max-w-7xl mx-auto px-8 py-12 mt-20">
    <div class="flex gap-8">
        
        <!-- Sidebar Filter -->
        <div class="w-72 flex-shrink-0">
            <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-8">
                
                <!-- Sort Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="ri-sort-desc"></i>
                        Sort By
                    </h3>
                    <form action="/shop" method="GET">

                        <select name="sortby" 
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 outline-none transition-all cursor-pointer bg-gray-50 hover:bg-white">
                            <option value="popular">Most Popular</option>
                            <option value="newest">Newest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                        </select>

                    </form>
                </div>

                <!-- Divider -->
                <div class="border-t border-gray-200 my-6"></div>

                <!-- Collections Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="ri-shopping-bag-3-line"></i>
                        Collections
                    </h3>
                    <div class="space-y-2">
                        <a href="/shop?collection=new" 
                           class="block px-4 py-3 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-all text-gray-700 font-medium">
                            <i class="ri-star-line mr-2"></i>New Collection
                        </a>
                        <a href="/shop" 
                           class="block px-4 py-3 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-all text-gray-700 font-medium">
                            <i class="ri-list-check mr-2"></i>All Products
                        </a>
                        <a href="/shop?discounted=true" 
                           class="block px-4 py-3 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-all text-gray-700 font-medium">
                            <i class="ri-price-tag-3-line mr-2"></i>Discounted Products
                        </a>
                    </div>
                </div>

                <!-- Divider -->
                <div class="border-t border-gray-200 my-6"></div>

                <!-- Filters Section -->
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="ri-filter-3-line"></i>
                        Filters
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500">
                            <span class="text-gray-700 group-hover:text-blue-600 transition-colors">In Stock</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500">
                            <span class="text-gray-700 group-hover:text-blue-600 transition-colors">On Sale</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500">
                            <span class="text-gray-700 group-hover:text-blue-600 transition-colors">Free Shipping</span>
                        </label>
                    </div>
                </div>

            </div>
        </div>

        <!-- Products Grid -->
        <div class="flex-1">
            <% if(products.length > 0) { %>
                
                <!-- Products Count -->
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">
                        <span class="text-blue-600"><%= products.length %></span> Products Found
                    </h2>
                    <div class="flex gap-2">
                        <button class="p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all">
                            <i class="ri-grid-fill text-xl text-gray-600"></i>
                        </button>
                        <button class="p-3 rounded-lg border-2 border-gray-200 hover:border-blue-500 hover:bg-blue-50 transition-all">
                            <i class="ri-list-unordered text-xl text-gray-600"></i>
                        </button>
                    </div>
                </div>

                <!-- Products Grid -->
                <div class="flex flex-wrap -mx-4 ">
            
                    <% products.forEach(product => { %>
                    <!-- Each product card - LARGER SPACING -->
                    <div class="w-4/5 sm:w-1/2 md:w-1/3 lg:w-1/4 px-4 mb-8 overflow-y-auto">

                        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden h-full flex flex-col">
                            
                            <!-- Product Image - LARGER -->
                            <div class="h-72 w-2/5 flex flex-shrink-0 items-center justify-center p-10" style="background-color: <%= product.bgcolor %>;">

                                <img class="w-3/4 h-52 object-contain hover:scale-105 transition-transform duration-300"
                                     src="data:image/png;base64,<%= product.image.toString('base64') %>" 
                                     alt="<%= product.name %>">

                            </div>
                            
                            <!-- Product Info -->
                            <div class="p-6 flex flex-col flex-grow" style="background-color: <%= product.panelcolor %>; color: <%= product.textcolor %>;">
                                
                                <h3 class="font-bold text-lg mb-3 truncate"><%= product.name %></h3>
                                
                                <div class="flex items-baseline gap-2 mb-4">
                                    <span class="text-2xl font-bold">₹<%= product.price %></span>
                                    <% if(product.discount) { %>
                                        <span class="text-sm line-through opacity-60">₹<%= product.originalPrice %></span>
                                    <% } %>
                                </div>
        
                                <div class="flex items-center gap-1 mb-auto opacity-90">

                                    <i class="ri-star-fill text-yellow-400"></i>
                                    <i class="ri-star-fill text-yellow-400"></i>
                                    <i class="ri-star-fill text-yellow-400"></i>
                                    <i class="ri-star-fill text-yellow-400"></i>
                                    <i class="ri-star-half-fill text-yellow-400"></i>
                                    <span class="text-sm ml-2">(4.5)</span>
                                    
                                </div>
        
                                <a href="/addtocart/<%= product._id %>" 
                                   class="flex items-center justify-center gap-2 mt-5 w-full py-3 rounded-xl font-semibold text-base transition-all hover:scale-105 active:scale-95 shadow-md"
                                   style="background-color: rgba(255, 255, 255, 0.25);">
                                    <i class="ri-shopping-cart-line text-lg"></i>
                                    <span>Add to Cart</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    <% }) %>
                </div>
        

            <% } else { %>
                
                <!-- Empty State -->
                <div class="flex flex-col items-center justify-center py-24">
                    <div class="w-64 h-64 mb-8 opacity-20">
                        <svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="100" cy="100" r="80" stroke="currentColor" stroke-width="4"/>
                            <path d="M70 100L90 120L130 80" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800 mb-4">No Products Found</h3>
                    <p class="text-gray-600 text-lg mb-8">We couldn't find any products matching your criteria</p>
                    <a href="/shop" class="px-8 py-4 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                        View All Products
                    </a>
                </div>

            <% } %>
        </div>

    </div>
</div>


<%- include('./partials/footer') %>