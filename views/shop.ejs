<%- include('./partials/header') %>

<% if(success && success.length > 0)  
{ %>
    <div class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 p-3 rounded-md bg-blue-500">
        <span class="inline-block mt-1 mb-1 text-white"> <%= success %> </span>
    </div>
<% } %>


<% if(error && error.length > 0)  
{ %>
    <div class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 p-3 rounded-md bg-red-500">
        <span class="inline-block mt-1 mb-1 text-white"> <%= error %> </span>
    </div>
<% } %>

<!-- Main Shop Section -->
<div class=" mx-auto px-8 py-12 mt-6">
    <div class="flex gap-8">
        
        <!-- Sidebar Filter -->
        <div class="w-72 flex-shrink-0">
            <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-8">
                
                <!-- Sort Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="ri-sort-desc"></i>
                        Sort By
                    </h3>
                    <form action="/shop" method="GET">

                        <select name="sortby" 
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:ring-4 focus:ring-blue-100 outline-none transition-all cursor-pointer bg-gray-50 hover:bg-white">
                            <option value="popular">Most Popular</option>
                            <option value="newest">Newest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                        </select>

                    </form>
                    
                </div>

                <!-- Divider -->
                <div class="border-t border-gray-200 my-6"></div>

                <!-- Collections Section -->
                <div class="mb-8">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="ri-shopping-bag-3-line"></i>
                        Collections
                    </h3>
                    <div class="space-y-2">
                        <a href="/shop?collection=new" 
                           class="block px-4 py-3 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-all text-gray-700 font-medium">
                            <i class="ri-star-line mr-2"></i>New Collection
                        </a>
                        <a href="/shop" 
                           class="block px-4 py-3 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-all text-gray-700 font-medium">
                            <i class="ri-list-check mr-2"></i>All Products
                        </a>
                        <a href="/shop?discounted=true" 
                           class="block px-4 py-3 rounded-lg hover:bg-blue-50 hover:text-blue-600 transition-all text-gray-700 font-medium">
                            <i class="ri-price-tag-3-line mr-2"></i>Discounted Products
                        </a>
                    </div>
                </div>

                <!-- Divider -->
                <div class="border-t border-gray-200 my-6"></div>

                <!-- Filters Section -->
                <div>
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <i class="ri-filter-3-line"></i>
                        Filters
                    </h3>
                    <div class="space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500">
                            <span class="text-gray-700 group-hover:text-blue-600 transition-colors">In Stock</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500">
                            <span class="text-gray-700 group-hover:text-blue-600 transition-colors">On Sale</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <input type="checkbox" class="w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500">
                            <span class="text-gray-700 group-hover:text-blue-600 transition-colors">Free Shipping</span>
                        </label>
                    </div>
                </div>

            </div>
        </div>

        <!-- Products Grid -->
    
            <% if(products.length>0 ){ %>
                <div class="w-full flex flex-col overflow-y-auto gap-5 h-screen bg-zinc-100 p-10 rounded-md border-2">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
            
                    <div class="flex flex-wrap gap-5 flex-shrink-0 ml-10">  
            
                        <% products.forEach(product => { %>
                        <div class="w-60 shadow-md">
                            
                            <div class="w-full flex items-center justify-center h-40 p-2" style="background-color:<%= product.bgcolor %>">
                                
                                    <img class="w-full h-full flex object-contain" src="data:image/png;base64,<%= product.image.toString('base64') %>" alt="">
                                
                            </div>
                            
                            <div class="flex justify-between items-center px-4 py-4" style="background-color: <%= product.panelcolor %>; color: <%= product.textcolor %>;">
                                
                                <div>
            
                                    <h3><%= product.name %></h3>
                                    <h4>â‚¹<%= product.price %></h4>
            
                                </div>
            
                                <a class="w-7 h-7 flex items-center justify-center rounded-full bg-zinc-200" href="/addtocart/<%= product._id %>">
                                    <i class="ri-add-line"></i>
                                </a>
            
                            </div>
                        </div>
                    <% }) %>
                
        

            <% } else { %>
                
                <!-- Empty State -->
                <div class="flex flex-col items-center justify-center py-24">
                    <div class="w-64 h-64 mb-8 opacity-20">
                        <svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="100" cy="100" r="80" stroke="currentColor" stroke-width="4"/>
                            <path d="M70 100L90 120L130 80" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800 mb-4">No Products Found</h3>
                    <p class="text-gray-600 text-lg mb-8">We couldn't find any products matching your criteria</p>
                    <a href="/shop" class="px-8 py-4 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                        View All Products
                    </a>
                </div>

            <% } %>
        </div>

    </div>
</div>


<%- include('./partials/footer') %>